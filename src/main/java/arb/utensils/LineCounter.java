package arb.utensils;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.stream.Stream;

import arb.documentation.BusinessSourceLicenseVersionOnePointOne;
import arb.documentation.TheArb4jLibrary;

/**
 * @see BusinessSourceLicenseVersionOnePointOne Â© terms of the
 *      {@link TheArb4jLibrary}
 */
public class LineCounter
{
  public static void main(String[] args) throws IOException
  {
    String sourceDir = args.length
                  > 0 ? args[0] : String.format("%s/git/arb4j", System.getProperty("user.home"));
    long   count     = countLines(sourceDir);
    System.out.format("Total Java lines (excluding SWIG files) in %s: %s", sourceDir, count);
  }

  protected static long countLines(String sourceDir) throws IOException
  {
    try ( Stream<Path> sourceFiles = Files.walk(Paths.get(sourceDir)))
    {
      return sourceFiles.filter(p -> shouldBeCounted(p)).mapToLong(p -> countLines(p)).sum();
    }
  }

  protected static long countLines(Path p)
  {
    try
    {
      return Files.lines(p).count();
    }
    catch (IOException e)
    {
      e.printStackTrace(System.err);
      return 0;
    }
  }

  protected static boolean shouldBeCounted(Path p)
  {
    try
    {
      return p.toString().endsWith(".java")
                    && Files.lines(p)
                            .noneMatch(line -> line.contains("This file was automatically generated by SWIG"));
    }
    catch (IOException e)
    {
      return false;
    }
  }
}
