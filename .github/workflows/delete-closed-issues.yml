name: Delete Closed Issues

on:
  workflow_dispatch:

jobs:
  delete-closed-issues:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Delete closed issues
        env:
          GITHUB_TOKEN: ${{ secrets.PAT_TOKEN }}
          REPO: ${{ github.repository }}
        run: |
          echo "üîç Fetching closed issues..."
          
          CLOSED_ISSUES=$(gh issue list \
            --repo "${REPO}" \
            --state closed \
            --limit 1000 \
            --json number \
            --jq '.[].number')
          
          if [ -z "${CLOSED_ISSUES}" ]; then
            echo "‚úÖ No closed issues found."
            exit 0
          fi
          
          ISSUE_COUNT=$(echo "${CLOSED_ISSUES}" | wc -l)
          echo "üìã Found ${ISSUE_COUNT} closed issues to delete"
          
          echo "üóëÔ∏è Deleting issues..."
          echo "${CLOSED_ISSUES}" | while read -r issue_number; do
            echo "Deleting issue #${issue_number}..."
            gh issue delete "${issue_number}" --repo "${REPO}" --yes
          done
          
          echo "‚úÖ Deleted ${ISSUE_COUNT} closed issues!"
