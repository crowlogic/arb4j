# .github/workflows/delete-closed-issues.yml
name: Delete Closed Issues

on:
  workflow_dispatch: # Manual trigger
  schedule:
    - cron: '0 0 * * 0' # Weekly on Sunday at midnight (optional)

jobs:
  delete-closed-issues:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Delete closed issues
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
        run: |
          echo "üîç Fetching closed issues..."
          
          # Get all closed issues (up to 1000)
          CLOSED_ISSUES=$(gh issue list \
            --repo "${REPO}" \
            --state closed \
            --limit 1000 \
            --json number \
            --jq '.[].number')
          
          if [ -z "${CLOSED_ISSUES}" ]; then
            echo "‚úÖ No closed issues found."
            exit 0
          fi
          
          ISSUE_COUNT=$(echo "${CLOSED_ISSUES}" | wc -l)
          echo "üìã Found ${ISSUE_COUNT} closed issues to delete"
          
          echo "üóëÔ∏è Deleting issues..."
          echo "${CLOSED_ISSUES}" | while read -r issue_number; do
            echo "Deleting issue #${issue_number}..."
            gh issue delete "${issue_number}" --repo "${REPO}" --yes
          done
          
          echo "‚úÖ Deleted ${ISSUE_COUNT} closed issues!"
